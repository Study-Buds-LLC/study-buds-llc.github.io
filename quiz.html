<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Buds Math Quiz</title>

<!-- Font Awesome for speaker icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

<style>
:root{
  --blue:#4f8df7;
  --soft:#eef4ff;
  --green:#22c55e;
  --red:#ef4444;
  --gray:#9ca3af;
}

body{
  margin:0;
  font-family:system-ui, Arial, sans-serif;
  background:#f4f7fb;
  display:flex;
  min-height:100vh;
}

/* Sidebar */
.sidebar{
  width:190px;
  background:#fff;
  border-right:1px solid #e5e7eb;
  padding:16px;
}
.sidebar h2{
  text-align:center;
  margin:8px 0 16px;
}
.q-num{
  padding:10px;
  margin-bottom:8px;
  border-radius:8px;
  background:var(--soft);
  text-align:center;
  cursor:pointer;
  font-weight:600;
}
.q-num.active{ background:var(--blue); color:#fff; }
.q-num.correct{ background:var(--green); color:#fff; }
.q-num.wrong{ background:var(--red); color:#fff; }
.q-num.skipped{ background:var(--gray); color:#fff; opacity:.6; }

/* Main */
.main{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:#fff;
  width:100%;
  max-width:520px;
  padding:28px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.hint{
  font-size:14px;
  color:#6b7280;
}
.question-container{
  display:flex;
  align-items:center;
  gap:10px;
}
.question{
  font-size:20px;
  margin:10px 0 20px;
  flex:1;
}

input{
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:10px;
  border:2px solid #e5e7eb;
}
input:focus{
  outline:none;
  border-color:var(--blue);
}

/* Fraction input */
.fraction{
  display:none;
  text-align:center;
}
.fraction input{
  width:120px;
  margin:6px auto;
}
.fraction-line{
  width:130px;
  height:2px;
  background:#111;
  margin:4px auto;
}

/* Buttons */
.buttons{
  display:flex;
  gap:10px;
  margin-top:18px;
}
button{
  flex:1;
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
.primary{ background:var(--blue); color:#fff; }
.secondary{ background:#e5e7eb; }

#ttsBtn{
  flex:none;
  padding:10px;
  border-radius:50%;
}

.score{
  margin-top:16px;
  font-weight:700;
}

/* Mobile */
@media(max-width:700px){
  body{ flex-direction:column; }
  .sidebar{
    width:100%;
    display:flex;
    overflow-x:auto;
    gap:8px;
  }
  .q-num{ min-width:42px; }
}
</style>
</head>

<body>

<div class="sidebar" id="sidebar">
  <h2>Math Quiz</h2>
</div>

<div class="main">
  <div class="card">
    <div id="hint" class="hint"></div>

    <div class="question-container">
      <div id="question" class="question"></div>
      <button id="ttsBtn" class="primary" onclick="readAloud()" title="Read aloud">
        <i class="fas fa-volume-up"></i>
      </button>
    </div>

    <input id="answer" placeholder="Your answer">

    <div id="fractionBox" class="fraction">
      <input id="num" placeholder="numerator">
      <div class="fraction-line"></div>
      <input id="den" placeholder="denominator">
    </div>

    <div class="buttons">
      <button class="primary" onclick="submitAnswer()">Submit</button>
      <button class="secondary" onclick="skipQuestion()">Skip</button>
      <button class="primary" id="nextBtn" onclick="nextQuestion()" style="display:none">
        Next
      </button>
    </div>

    <div id="score" class="score"></div>
  </div>
</div>

<!-- SFX -->
<audio id="sfx-correct" src="correct.mp3" preload="auto"></audio>
<audio id="sfx-wrong" src="wrong.mp3" preload="auto"></audio>

<script>
// ==========================
// Question Library
// ==========================
const QUESTION_LIBRARY = [
  { type: "normal", q: "9 + 8 = ?", a: "17", hint: "Add" },
  { type: "normal", q: "15 âˆ’ 6 = ?", a: "9", hint: "Subtract" },
  { type: "normal", q: "6 Ã— 4 = ?", a: "24", hint: "Multiply" },
  { type: "normal", q: "12 Ã· 3 = ?", a: "4", hint: "Divide" },
  { type: "fraction", q: "1/2 + 1/4 = ?", a: "3/4", hint: "Add fractions" },
  { type: "fraction", q: "2/3 + 1/3 = ?", a: "3/3", hint: "Add fractions" },
  { type: "fraction", q: "3/4 + 1/4 = ?", a: "4/4", hint: "Whole" },
  { type: "story", q: "Anna has 10 apples and eats 3. How many left?", a: "7", hint: "Subtract" },
  { type: "story", q: "Candy costs $2 each. Buy 4. Total cost?", a: "8", hint: "Multiply" },
  { type: "normal", q: "20 âˆ’ 9 = ?", a: "11", hint: "Subtract" },
  { type: "normal", q: "5 Ã— 5 = ?", a: "25", hint: "Multiply" },
  { type: "normal", q: "18 Ã· 6 = ?", a: "3", hint: "Divide" },
  { type: "normal", q: "7 + 6 = ?", a: "13", hint: "Add" },
  { type: "normal", q: "30 âˆ’ 10 = ?", a: "20", hint: "Subtract" },
  { type: "normal", q: "8 Ã— 3 = ?", a: "24", hint: "Multiply" },
  { type: "normal", q: "16 Ã· 4 = ?", a: "4", hint: "Divide" },
  { type: "normal", q: "14 + 5 = ?", a: "19", hint: "Add" },
  { type: "normal", q: "9 Ã— 2 = ?", a: "18", hint: "Multiply" },
  { type: "normal", q: "11 + 7 = ?", a: "18", hint: "Add" },
  { type: "normal", q: "21 Ã· 7 = ?", a: "3", hint: "Divide" },
  { type: "story", q: "Mono has 30 StudyCoins, he went to fruit store in Lumo Market to buy some apples and oranges. <br /> The Seller Told Him This: <br /> <br /> <div style='border: 2px solid black; padding: 10px; border-radius: 6px;'> 1 Apple = 10 StudyCoins <br /> 1 Orange = 5 StudyCoins </div> <br /> How much money did Mono spend if he wants 1 Apple and 1 Orange?", a: "15", hint: "Finding Totals" },
  { type: "fraction", q: "2/3 + 2/6 = ?", a: "4/6", hint: "Make Denominators Same. Then Add" },
  { type: "story", q: "Alex loves eating. <br /> On <b>Monday</b> he ate 5 Burgers. On <b>Thursday</b> he ate 10 Burgers. How Much Did He Eat In Total?", a: "15", hint: "Finding Totals" },
  { type: "fraction", q: "What is 2/3 + 2/9", a: "5/9", hint: "Add" },
  { type: "normal", q: "Round 145 to the nearest hundred", a: "100", hint: "Lower than 50 = Round Down" },
  { type: "normal", q: "What's 56 rounded to the nearest 10?", a: "60", hint: "Higher than 50 round up" },

  // --- NEW QUESTIONS ---
  { type: "normal", q: "25 + 17 = ?", a: "42", hint: "Add" },
  { type: "normal", q: "40 âˆ’ 18 = ?", a: "22", hint: "Subtract" },
  { type: "normal", q: "7 Ã— 6 = ?", a: "42", hint: "Multiply" },
  { type: "normal", q: "81 Ã· 9 = ?", a: "9", hint: "Divide" },
  { type: "fraction", q: "1/3 + 1/6 = ?", a: "1/2", hint: "Make Denominators Same. Then Add" },
  { type: "fraction", q: "5/8 âˆ’ 1/4 = ?", a: "3/8", hint: "Subtract Fractions" },
  { type: "story", q: "Lily had 12 candies. She gave 4 to her friend. How many does she have now?", a: "8", hint: "Subtract" },
  { type: "story", q: "Tom bought 3 packs of pencils. Each pack has 6 pencils. How many pencils in total?", a: "18", hint: "Multiply" },
  { type: "normal", q: "Round 367 to the nearest ten", a: "370", hint: "Round to nearest ten" },
  { type: "normal", q: "Round 822 to the nearest hundred", a: "800", hint: "Round to nearest hundred" }
];


// ==========================
// Shuffle & Pick 10
// ==========================
function shuffle(array){ return array.sort(()=>Math.random()-0.5); }
const quiz = shuffle([...QUESTION_LIBRARY]).slice(0,15);

// ==========================
// State
// ==========================
let current = 0;
let score = 0;
let status = Array(quiz.length).fill("pending");

// ==========================
// SFX
// ==========================
const correctSFX = document.getElementById("sfx-correct");
const wrongSFX = document.getElementById("sfx-wrong");

// ==========================
// Sidebar
// ==========================
const sidebar = document.getElementById("sidebar");
quiz.forEach((_,index)=>{
  const box = document.createElement("div");
  box.className="q-num";
  box.textContent=index+1;
  box.onclick = ()=>showQuestion(index);
  sidebar.appendChild(box);
});

// ==========================
// TTS function
// ==========================
function readAloud(){
  const q = quiz[current];
  if ('speechSynthesis' in window) {
    const utter = new SpeechSynthesisUtterance();

    // Format fractions and symbols for clarity
    const formattedText = q.q
      .replace(/\//g, ' over ')
      .replace(/Ã·/g, ' divided by ')
      .replace(/Ã—/g, ' times ')
      .replace(/âˆ’/g, ' minus ')
      .replace(/\+/g, ' plus ')
      .replace(/=/g, ' equals ');

    utter.text = formattedText;
    utter.rate = 0.9;
    utter.pitch = 1.0; // male voice slightly lower

    // Wait for voices to load
    const voices = window.speechSynthesis.getVoices();
    const googleUKMale = voices.find(v => v.name.includes("Google UK English Male"));
    if (googleUKMale) utter.voice = googleUKMale;

    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utter);
  }
}

// Some browsers load voices asynchronously
if (typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = () => {};
}




// ==========================
// Show Question
// ==========================
function showQuestion(index){
  current=index;
  const q = quiz[index];
  document.getElementById("question").innerHTML = q.q;
  document.getElementById("hint").textContent = q.hint;
  document.getElementById("answer").style.display = q.type==="fraction"?"none":"block";
  document.getElementById("fractionBox").style.display = q.type==="fraction"?"block":"none";
  document.getElementById("answer").value = "";
  document.getElementById("num").value = "";
  document.getElementById("den").value = "";
  document.getElementById("nextBtn").style.display="none";
  updateSidebar();
  readAloud(); // read question automatically
}

// ==========================
// Update Sidebar
// ==========================
function updateSidebar(){
  document.querySelectorAll(".q-num").forEach((el,i)=>{
    el.className="q-num";
    if(i===current) el.classList.add("active");
    if(status[i]==="correct") el.classList.add("correct");
    if(status[i]==="wrong") el.classList.add("wrong");
    if(status[i]==="skipped") el.classList.add("skipped");
  });
}

// ==========================
// Actions
// ==========================
function submitAnswer(){
  const q = quiz[current];
  let answer = q.type==="fraction"?
    document.getElementById("num").value+"/"+document.getElementById("den").value:
    document.getElementById("answer").value.trim();
  if(!answer) return;
  if(answer===q.a){
    status[current]="correct";
    score++;
    correctSFX.currentTime=0; correctSFX.play();
    document.getElementById("nextBtn").style.display="block";
  }else{
    status[current]="wrong";
    wrongSFX.currentTime=0; wrongSFX.play();
  }
  updateSidebar();
}

function skipQuestion(){
  status[current]="skipped";
  nextQuestion();
}

function nextQuestion(){
  const next=status.findIndex(s=>"pending"===s);
  if(next!==-1) showQuestion(next);
  else finishQuiz();
}

function finishQuiz(){
  document.getElementById("question").textContent="ðŸŽ‰ Quiz Finished!";
  document.getElementById("hint").textContent="";
  document.getElementById("answer").style.display="none";
  document.getElementById("fractionBox").style.display="none";
  document.querySelector(".buttons").style.display="none";
  document.getElementById("score").textContent=`Score: ${score} / ${quiz.length}`;
  readAloud(); // speak the final message
}

// ==========================
// Start
// ==========================
showQuestion(0);
</script>

</body>
</html>
